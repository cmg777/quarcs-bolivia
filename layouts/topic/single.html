{{ define "head" }}
  {{ partial "leaflet-loader" . }}
{{ end }}

{{ define "body" }}
  {{ $rows := readFile "static/data/GeoDS4Bolivia/datadefinitions.csv" | transform.Unmarshal }}
  {{ $vars := .Params.vars }}
  {{ $choroplethVar := .Params.choroplethVar }}
  {{ $choroplethGrades := .Params.choroplethGrades }}
  {{- partial "banner.html" (dict "fill" "#6A589C" "heading" "Topic: " "context" .) -}}
  <section class="flex flex-col justify-center px-4 py-2 g-4">
    {{/*  Standard layout for topic page - must include map, header, and link to data  */}}
    <div class="flex flex-col gap-4 text-left">
      <div 
        id="map"
        class="w-11/12 h-[80vh] self-center"
        data-lat="-16.2902"
        data-lng="-63.5887"
        data-zoom="6"
        data-path="/data/GeoDS4Bolivia/GeoDS4Bolivia.geojson"
        data-vars="{{ jsonify $vars }}"
        data-choropleth-var="{{ $choroplethVar }}"
        data-choropleth-grades="{{ jsonify $choroplethGrades }}"
      >
      </div>
      <div class="text-3xl font-bold">Variables and Data</div>
      <a class="box-border block px-2 leading-8 text-center text-white no-underline transition rounded bg-slate-800 w-fit duration-125 hover:bg-slate-900" download href="/data/GeoDS4Bolivia.geojson">Download data</a>
      <table class="border-collapse">
        {{ range $rows }}
          {{ if in $vars (index . 0) }}
            <tr class="even:bg-gray-50 odd:bg-white">
              {{ range . }} <td class="p-2 text-left border-black border-solid border-1">{{ . }}</td> {{ end }}
            </tr>
          {{ end }}
        {{ end }}
      </table>
    </div>

    {{/*  List of stories under the topic  */}}
    <div>
      <div class="mt-4 mb-1 text-3xl font-bold leading-5">Stories</div>
      <div class="mb-2 text-xl text-slate-700">Blog post-like tidbits written by people like you.</div>
      <div class="grid place-items-center">
        <div class="box-border flex flex-col justify-center w-11/12">
          {{ range .Resources }}
            {{/* Story must have an author, title, and date to be visible */}}
            {{ if and .Params.title .Params.author .Params.date }}
              <div class="px-8 py-4 my-4 rounded bg-slate-50">
                <div class="my-3">
                  <div class="text-2xl font-semibold">{{ .Params.title }}</div>
                  <div class="mt-2 mb-4">
                    <div class="flex flex-row gap-8 my-2">
                      <div>By: {{ .Params.author }}</div>
                      <div>{{ .Params.date.Format "Jan 2, 2006" }}</div>
                    </div>
                    <div class="flex flex-row gap-2 my-2">
                      {{ if .Params.data }}<a class="box-border block px-2 leading-8 text-center text-white no-underline transition rounded bg-slate-800 w-fit duration-125 hover:bg-slate-900" download href="{{ .Params.data }}" target="_blank">Download Data</a>{{end}}
                      {{ if .Params.deepnote }}<a class="box-border block px-2 leading-8 text-center text-white no-underline transition rounded bg-slate-800 w-fit duration-125 hover:bg-slate-900" href="{{ .Params.deepnote }}" target="_blank">Link to Deepnote</a>{{end}}
                    </div>
                    <div class="box-border flex flex-row flex-wrap w-full gap-2 py-2">
                      {{ range $category := .Params.categories }}
                        {{- partial "tag.html" $category -}}
                      {{- end -}}
                    </div>
                  </div>
                </div>
                
                <div class="text-lg">
                  {{ .Content }}
                </div>
              </div>
            {{end}}
          {{ end }}
        </div>
      </div>
    </div>
  </section>
{{ end }}
